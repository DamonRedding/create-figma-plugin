{"version":3,"file":"textbox-d5d5650c.js","sources":["../../src/components/textbox/textbox/private/raw-textbox.tsx","../../src/components/textbox/textbox/textbox.tsx"],"sourcesContent":["import { MIXED_STRING } from '@create-figma-plugin/utilities'\nimport { h, JSX, RefObject } from 'preact'\nimport { useCallback, useRef, useState } from 'preact/hooks'\n\nimport { OnValueChange, Props } from '../../../../types/types.js'\nimport { getCurrentFromRef } from '../../../../utilities/get-current-from-ref.js'\nimport { isKeyCodeCharacterGenerating } from '../../private/is-keycode-character-generating.js'\n\nconst EMPTY_STRING = ''\n\nexport type RawTextboxProps<Name extends string> = {\n  disabled?: boolean\n  name?: Name\n  onBlur?: OmitThisParameter<JSX.FocusEventHandler<HTMLInputElement>>\n  onFocus?: OmitThisParameter<JSX.FocusEventHandler<HTMLInputElement>>\n  onKeyDown?: OmitThisParameter<JSX.KeyboardEventHandler<HTMLInputElement>>\n  onMouseUp?: OmitThisParameter<JSX.MouseEventHandler<HTMLInputElement>>\n  onInput?: OmitThisParameter<JSX.GenericEventHandler<HTMLInputElement>>\n  onValueInput?: OnValueChange<string, Name>\n  password?: boolean\n  placeholder?: string\n  propagateEscapeKeyDown?: boolean\n  revertOnEscapeKeyDown?: boolean\n  spellCheck?: boolean\n  validateOnBlur?: (value: string) => string | boolean\n  value: string\n}\n\nexport function RawTextbox<Name extends string>({\n  disabled = false,\n  name,\n  onBlur = function () {},\n  onFocus = function () {},\n  onInput = function () {},\n  onKeyDown = function () {},\n  onMouseUp = function () {},\n  onValueInput = function () {},\n  password = false,\n  placeholder,\n  propagateEscapeKeyDown = true,\n  revertOnEscapeKeyDown = false,\n  spellCheck = false,\n  validateOnBlur,\n  value,\n  ...rest\n}: Props<HTMLInputElement, RawTextboxProps<Name>>): JSX.Element {\n  const inputElementRef: RefObject<HTMLInputElement> = useRef(null)\n  const revertOnEscapeKeyDownRef: RefObject<boolean> = useRef(false) // Boolean flag to exit early from `handleBlur`\n\n  const [originalValue, setOriginalValue] = useState(EMPTY_STRING) // Value of the textbox when it was initially focused\n\n  const setInputElementValue = useCallback(function (value: string): void {\n    const inputElement = getCurrentFromRef(inputElementRef)\n    inputElement.value = value\n    const inputEvent = document.createEvent('Event')\n    inputEvent.initEvent('input', true, true)\n    inputElement.dispatchEvent(inputEvent)\n  }, [])\n\n  const handleBlur = useCallback(\n    function (event: JSX.TargetedFocusEvent<HTMLInputElement>): void {\n      if (revertOnEscapeKeyDownRef.current === true) {\n        revertOnEscapeKeyDownRef.current = false\n        return\n      }\n      onBlur(event)\n      if (typeof validateOnBlur !== 'undefined') {\n        const result = validateOnBlur(value)\n        if (typeof result === 'string') {\n          // Set to the value returned by `validateOnBlur`\n          setInputElementValue(result)\n          setOriginalValue(EMPTY_STRING)\n          return\n        }\n        if (result === false) {\n          // Revert the original value\n          if (value !== originalValue) {\n            setInputElementValue(originalValue)\n          }\n          setOriginalValue(EMPTY_STRING)\n          return\n        }\n      }\n      setOriginalValue(EMPTY_STRING)\n    },\n    [onBlur, originalValue, setInputElementValue, validateOnBlur, value]\n  )\n\n  const handleFocus = useCallback(\n    function (event: JSX.TargetedFocusEvent<HTMLInputElement>): void {\n      onFocus(event)\n      setOriginalValue(value)\n      event.currentTarget.select()\n    },\n    [onFocus, value]\n  )\n\n  const handleInput = useCallback(\n    function (event: JSX.TargetedEvent<HTMLInputElement>): void {\n      onValueInput(event.currentTarget.value, name)\n      onInput(event)\n    },\n    [name, onInput, onValueInput]\n  )\n\n  const handleKeyDown = useCallback(\n    function (event: JSX.TargetedKeyboardEvent<HTMLInputElement>): void {\n      onKeyDown(event)\n      const key = event.key\n      if (key === 'Escape') {\n        if (propagateEscapeKeyDown === false) {\n          event.stopPropagation()\n        }\n        if (revertOnEscapeKeyDown === true) {\n          revertOnEscapeKeyDownRef.current = true\n          setInputElementValue(originalValue)\n          setOriginalValue(EMPTY_STRING)\n        }\n        event.currentTarget.blur()\n        return\n      }\n      if (key === 'Enter') {\n        event.currentTarget.blur()\n        return\n      }\n      if (\n        value === MIXED_STRING &&\n        isKeyCodeCharacterGenerating(event.keyCode) === false\n      ) {\n        // Prevent changing the cursor position with the keyboard if `value` is `MIXED_STRING`\n        event.preventDefault()\n        event.currentTarget.select()\n      }\n    },\n    [\n      onKeyDown,\n      originalValue,\n      propagateEscapeKeyDown,\n      revertOnEscapeKeyDown,\n      setInputElementValue,\n      value\n    ]\n  )\n\n  const handleMouseUp = useCallback(\n    function (event: JSX.TargetedMouseEvent<HTMLInputElement>): void {\n      onMouseUp(event)\n      if (value === MIXED_STRING) {\n        // Prevent changing the selection if `value` is `MIXED_STRING`\n        event.preventDefault()\n      }\n    },\n    [onMouseUp, value]\n  )\n\n  return (\n    <input\n      {...rest}\n      ref={inputElementRef}\n      disabled={disabled === true}\n      name={name}\n      onBlur={handleBlur}\n      onFocus={handleFocus}\n      onInput={handleInput}\n      onKeyDown={handleKeyDown}\n      onMouseUp={handleMouseUp}\n      placeholder={placeholder}\n      spellcheck={spellCheck}\n      tabIndex={disabled === true ? -1 : 0}\n      type={password === true ? 'password' : 'text'}\n      value={value === MIXED_STRING ? 'Mixed' : value}\n    />\n  )\n}\n","import { ComponentChildren, h, JSX } from 'preact'\n\nimport { Props } from '../../../types/types.js'\nimport { createClassName } from '../../../utilities/create-class-name.js'\nimport { RawTextbox, RawTextboxProps } from './private/raw-textbox.js'\nimport styles from './textbox.module.css'\n\nexport type TextboxProps<Name extends string> = RawTextboxProps<Name> & {\n  icon?: ComponentChildren\n  variant?: TextboxVariant\n}\n\nexport type TextboxVariant = 'border' | 'underline'\n\nexport function Textbox<Name extends string>({\n  icon,\n  variant,\n  ...rest\n}: Props<HTMLInputElement, TextboxProps<Name>>): JSX.Element {\n  if (typeof icon === 'string' && icon.length !== 1) {\n    throw new Error(`String \\`icon\\` must be a single character: ${icon}`)\n  }\n\n  return (\n    <div\n      class={createClassName([\n        styles.textbox,\n        typeof variant === 'undefined'\n          ? null\n          : variant === 'border'\n          ? styles.hasBorder\n          : null,\n        typeof icon === 'undefined' ? null : styles.hasIcon,\n        rest.disabled === true ? styles.disabled : null\n      ])}\n    >\n      <RawTextbox {...rest} class={styles.input} />\n      {typeof icon === 'undefined' ? null : (\n        <div class={styles.icon}>{icon}</div>\n      )}\n      <div class={styles.border} />\n      {variant === 'underline' ? <div class={styles.underline} /> : null}\n    </div>\n  )\n}\n"],"names":["EMPTY_STRING","RawTextbox","disabled","name","onBlur","onFocus","onInput","onKeyDown","onMouseUp","onValueInput","password","placeholder","propagateEscapeKeyDown","revertOnEscapeKeyDown","spellCheck","validateOnBlur","value","rest","inputElementRef","useRef","revertOnEscapeKeyDownRef","originalValue","setOriginalValue","useState","setInputElementValue","useCallback","inputElement","getCurrentFromRef","inputEvent","document","createEvent","initEvent","dispatchEvent","handleBlur","event","current","result","handleFocus","currentTarget","select","handleInput","handleKeyDown","key","stopPropagation","blur","MIXED_STRING","isKeyCodeCharacterGenerating","keyCode","preventDefault","handleMouseUp","_jsx","ref","spellcheck","tabIndex","type","Textbox","icon","variant","length","Error","_jsxs","class","createClassName","styles","textbox","hasBorder","hasIcon","children","input","border","underline"],"mappings":"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"}