{"version":3,"file":"use-form.stories-0891a18d.js","sources":["../../src/hooks/use-window-key-down.ts","../../src/hooks/use-form/use-form.ts"],"sourcesContent":["import { useCallback, useEffect } from 'preact/hooks'\n\nexport function useWindowKeyDown(\n  key: KeyboardEvent['key'],\n  onKeyDown: (event: KeyboardEvent) => void\n): void {\n  const handleKeyDown = useCallback(\n    function (event: KeyboardEvent): void {\n      if (event.key !== key) {\n        return\n      }\n      onKeyDown(event)\n    },\n    [key, onKeyDown]\n  )\n\n  useEffect(\n    function (): () => void {\n      window.addEventListener('keydown', handleKeyDown)\n      return function (): void {\n        window.removeEventListener('keydown', handleKeyDown)\n      }\n    },\n    [handleKeyDown]\n  )\n}\n","import { useCallback, useState } from 'preact/hooks'\n\nimport { useFocusTrap } from '../use-focus-trap/use-focus-trap.js'\nimport {\n  InitialFocus,\n  useInitialFocus\n} from '../use-initial-focus/use-initial-focus.js'\nimport { useWindowKeyDown } from '../use-window-key-down.js'\n\nexport function useForm<State>(\n  initialState: State,\n  options: {\n    close: (state: State) => void\n    transform?: (state: State) => State\n    validate?: (state: State) => boolean\n    submit: (state: State) => void\n  }\n): {\n  disabled: boolean\n  formState: State\n  handleSubmit: () => void\n  initialFocus: InitialFocus\n  setFormState: <Name extends keyof State>(\n    state: State[Name],\n    name: undefined | Name\n  ) => void\n} {\n  const { close, submit, transform, validate } = options\n\n  const [formState, setState] = useState(initialState)\n\n  const setFormState = useCallback(\n    function <Name extends keyof State>(value: State[Name], name?: Name) {\n      if (typeof name === 'undefined') {\n        throw new Error('`name` is `undefined`')\n      }\n      setState(function (previousState: State): State {\n        const newState = {\n          ...previousState,\n          ...{ [name]: value }\n        }\n        return typeof transform === 'undefined' ? newState : transform(newState)\n      })\n    },\n    [transform]\n  )\n\n  const handleSubmit = useCallback(\n    function (): void {\n      if (typeof validate !== 'undefined' && validate(formState) === false) {\n        return\n      }\n      submit(formState)\n    },\n    [formState, submit, validate]\n  )\n  useWindowKeyDown('Enter', handleSubmit)\n\n  const handleClose = useCallback(\n    function (): void {\n      close(formState)\n    },\n    [close, formState]\n  )\n  useWindowKeyDown('Escape', handleClose)\n\n  useFocusTrap()\n\n  const disabled =\n    typeof validate !== 'undefined' ? validate(formState) === false : false\n\n  const initialFocus = useInitialFocus()\n  return {\n    disabled,\n    formState,\n    handleSubmit,\n    initialFocus,\n    setFormState\n  }\n}\n"],"names":["useWindowKeyDown","key","onKeyDown","handleKeyDown","useCallback","event","useEffect","addEventListener","removeEventListener","useForm","initialState","options","close","submit","transform","validate","formState","setState","useState","setFormState","value","name","Error","previousState","newState","handleSubmit","handleClose","useFocusTrap","disabled","initialFocus","useInitialFocus"],"mappings":"uwBAEgBA,SAAAA,EACdC,EACAC,EACM,CACAC,MAAAA,EAAgBC,EACpB,SAAUC,EAA4B,CAChCA,EAAMJ,MAAQA,GAGlBC,EAAUG,CAAK,CAAA,EAEjB,CAACJ,EAAKC,CAAS,CACjB,EAEAI,EACE,UAAwB,CACfC,cAAAA,iBAAiB,UAAWJ,CAAa,EACzC,UAAkB,CAChBK,OAAAA,oBAAoB,UAAWL,CAAa,CAAA,CACrD,EAEF,CAACA,CAAa,CAChB,CACF,CChBgBM,SAAAA,EACdC,EACAC,EAeA,CACM,KAAA,CAAEC,MAAAA,EAAOC,OAAAA,EAAQC,UAAAA,EAAWC,SAAAA,CAAaJ,EAAAA,EAEzC,CAACK,EAAWC,CAAQ,EAAIC,EAASR,CAAY,EAE7CS,EAAef,EACnB,SAAoCgB,EAAoBC,EAAa,CAC/D,GAAA,OAAOA,EAAS,IACZ,MAAA,IAAIC,MAAM,uBAAuB,EAEzCL,EAAS,SAAUM,EAA6B,CAC9C,MAAMC,EAAW,CACf,GAAGD,EACE,CAACF,CAAI,EAAGD,CAAM,EAErB,OAAO,OAAON,EAAc,IAAcU,EAAWV,EAAUU,CAAQ,CAAA,CACxE,CAAA,EAEH,CAACV,CAAS,CACZ,EAEMW,EAAerB,EACnB,UAAkB,CACZ,OAAOW,EAAa,KAAeA,EAASC,CAAS,IAAM,IAG/DH,EAAOG,CAAS,CAElB,EAAA,CAACA,EAAWH,EAAQE,CAAQ,CAC9B,EACAf,EAAiB,QAASyB,CAAY,EAEhCC,MAAAA,EAActB,EAClB,UAAkB,CAChBQ,EAAMI,CAAS,CAAA,EAEjB,CAACJ,EAAOI,CAAS,CACnB,EACAhB,EAAiB,SAAU0B,CAAW,EAEzBC,IAEb,MAAMC,EACJ,OAAOb,EAAa,IAAcA,EAASC,CAAS,IAAM,GAAQ,GAE9Da,EAAeC,IACd,MAAA,CACLF,SAAAA,EACAZ,UAAAA,EACAS,aAAAA,EACAI,aAAAA,EACAV,aAAAA,CAAAA,CAEJ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;"}