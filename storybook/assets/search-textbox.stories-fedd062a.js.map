{"version":3,"file":"search-textbox.stories-fedd062a.js","sources":["../../src/components/search-textbox/search-textbox.tsx"],"sourcesContent":["import { h, RefObject } from 'preact'\nimport { useCallback, useRef } from 'preact/hooks'\n\nimport { IconCross32 } from '../../icons/icon-32/icon-cross-32.js'\nimport { IconSearch32 } from '../../icons/icon-32/icon-search-32.js'\nimport { Event, EventHandler } from '../../types/event-handler.js'\nimport { FocusableComponentProps } from '../../types/focusable-component-props.js'\nimport { createClassName } from '../../utilities/create-class-name.js'\nimport { createComponent } from '../../utilities/create-component.js'\nimport { getCurrentFromRef } from '../../utilities/get-current-from-ref.js'\nimport { noop } from '../../utilities/no-op.js'\nimport styles from './search-textbox.module.css'\n\nconst EMPTY_STRING = ''\n\nexport interface SearchTextboxProps\n  extends FocusableComponentProps<HTMLInputElement> {\n  clearOnEscapeKeyDown?: boolean\n  disabled?: boolean\n  onFocus?: EventHandler.onFocus<HTMLInputElement>\n  onInput?: EventHandler.onInput<HTMLInputElement>\n  onKeyDown?: EventHandler.onKeyDown<HTMLInputElement>\n  onValueInput?: EventHandler.onValueChange<string>\n  placeholder?: string\n  spellCheck?: boolean\n  value: string\n}\n\nexport const SearchTextbox = createComponent<\n  HTMLInputElement,\n  SearchTextboxProps\n>(function (\n  {\n    clearOnEscapeKeyDown = false,\n    disabled = false,\n    onFocus = noop,\n    onInput = noop,\n    onKeyDown = noop,\n    onValueInput = noop,\n    placeholder,\n    propagateEscapeKeyDown = true,\n    spellCheck = false,\n    value,\n    ...rest\n  },\n  ref\n) {\n  const inputElementRef: RefObject<HTMLInputElement> = useRef(null)\n\n  const handleClearButtonClick = useCallback(function () {\n    const inputElement = getCurrentFromRef(inputElementRef)\n    inputElement.value = EMPTY_STRING\n    const inputEvent = new window.Event('input', {\n      bubbles: true,\n      cancelable: true\n    })\n    inputElement.dispatchEvent(inputEvent)\n    inputElement.focus()\n  }, [])\n\n  const handleFocus = useCallback(\n    function (event: Event.onFocus<HTMLInputElement>) {\n      onFocus(event)\n      event.currentTarget.select()\n    },\n    [onFocus]\n  )\n\n  const handleInput = useCallback(\n    function (event: Event.onInput<HTMLInputElement>) {\n      onInput(event)\n      const value = event.currentTarget.value\n      onValueInput(value)\n    },\n    [onInput, onValueInput]\n  )\n\n  const handleKeyDown = useCallback(\n    function (event: Event.onKeyDown<HTMLInputElement>) {\n      onKeyDown(event)\n      if (event.key === 'Escape') {\n        if (clearOnEscapeKeyDown === true && value !== EMPTY_STRING) {\n          event.stopPropagation() // Clear the value without bubbling up the `Escape` key press\n          handleClearButtonClick()\n          return\n        }\n        if (propagateEscapeKeyDown === false) {\n          event.stopPropagation()\n        }\n        event.currentTarget.blur()\n      }\n    },\n    [\n      clearOnEscapeKeyDown,\n      handleClearButtonClick,\n      onKeyDown,\n      propagateEscapeKeyDown,\n      value\n    ]\n  )\n\n  const refCallback = useCallback(\n    function (inputElement: null | HTMLInputElement) {\n      inputElementRef.current = inputElement\n      if (ref === null) {\n        return\n      }\n      if (typeof ref === 'function') {\n        ref(inputElement)\n        return\n      }\n      ref.current = inputElement\n    },\n    [ref]\n  )\n\n  return (\n    <div\n      class={createClassName([\n        styles.searchTextbox,\n        disabled === true ? styles.disabled : null\n      ])}\n    >\n      <input\n        {...rest}\n        ref={refCallback}\n        class={styles.input}\n        disabled={disabled === true}\n        onFocus={handleFocus}\n        onInput={handleInput}\n        onKeyDown={handleKeyDown}\n        placeholder={placeholder}\n        spellcheck={spellCheck}\n        tabIndex={0}\n        type=\"text\"\n        value={value}\n      />\n      <div class={styles.searchIcon}>\n        <IconSearch32 />\n      </div>\n      {value === EMPTY_STRING || disabled === true ? null : (\n        <button\n          class={styles.clearButton}\n          onClick={handleClearButtonClick}\n          tabIndex={0}\n        >\n          <IconCross32 />\n        </button>\n      )}\n    </div>\n  )\n})\n"],"names":["EMPTY_STRING","SearchTextbox","createComponent","clearOnEscapeKeyDown","disabled","onFocus","noop","onInput","onKeyDown","onValueInput","placeholder","propagateEscapeKeyDown","spellCheck","value","rest","ref","inputElementRef","useRef","handleClearButtonClick","useCallback","inputElement","getCurrentFromRef","inputEvent","window","Event","bubbles","cancelable","dispatchEvent","focus","handleFocus","event","currentTarget","select","handleInput","handleKeyDown","key","stopPropagation","blur","refCallback","current","_jsxs","class","createClassName","styles","searchTextbox","children","_jsx","input","spellcheck","tabIndex","type","searchIcon","IconSearch32","clearButton","onClick","IconCross32"],"mappings":"2rBAaMA,EAAe,GAeRC,EAAgBC,GAG3B,SACA,CACEC,qBAAAA,EAAuB,GACvBC,SAAAA,EAAW,GACXC,QAAAA,EAAUC,EACVC,QAAAA,EAAUD,EACVE,UAAAA,EAAYF,EACZG,aAAAA,EAAeH,EACfI,YAAAA,GACAC,uBAAAA,EAAyB,GACzBC,WAAAA,GAAa,GACbC,MAAAA,EACA,GAAGC,EACL,EACAC,EACA,CACMC,MAAAA,EAA+CC,GAAO,IAAI,EAE1DC,EAAyBC,EAAY,UAAY,CAC/CC,MAAAA,EAAeC,GAAkBL,CAAe,EACtDI,EAAaP,MAAQb,EACrB,MAAMsB,EAAa,IAAIC,OAAOC,MAAM,QAAS,CAC3CC,QAAS,GACTC,WAAY,EAAA,CACb,EACDN,EAAaO,cAAcL,CAAU,EACrCF,EAAaQ,MAAM,CACrB,EAAG,CAAE,CAAA,EAECC,GAAcV,EAClB,SAAUW,EAAwC,CAChDzB,EAAQyB,CAAK,EACbA,EAAMC,cAAcC,QAAO,EAE7B,CAAC3B,CAAO,CACV,EAEM4B,GAAcd,EAClB,SAAUW,EAAwC,CAChDvB,EAAQuB,CAAK,EACPjB,MAAAA,EAAQiB,EAAMC,cAAclB,MAClCJ,EAAaI,CAAK,CAAA,EAEpB,CAACN,EAASE,CAAY,CACxB,EAEMyB,GAAgBf,EACpB,SAAUW,EAA0C,CAE9CA,GADJtB,EAAUsB,CAAK,EACXA,EAAMK,MAAQ,SAAU,CACtBhC,GAAAA,IAAyB,IAAQU,IAAUb,EAAc,CAC3D8B,EAAMM,gBAAgB,EACClB,IACvB,MACF,CACIP,IAA2B,IAC7BmB,EAAMM,gBAAgB,EAExBN,EAAMC,cAAcM,MACtB,CAAA,EAEF,CACElC,EACAe,EACAV,EACAG,EACAE,CAAK,CAET,EAEMyB,GAAcnB,EAClB,SAAUC,EAAuC,CAE/C,GADAJ,EAAgBuB,QAAUnB,EACtBL,IAAQ,KAGR,IAAA,OAAOA,GAAQ,WAAY,CAC7BA,EAAIK,CAAY,EAChB,MACF,CACAL,EAAIwB,QAAUnB,EAAAA,EAEhB,CAACL,CAAG,CACN,EAEA,OACEyB,EAAA,MAAA,CACEC,MAAOC,GAAgB,CACrBC,EAAOC,cACPxC,IAAa,GAAOuC,EAAOvC,SAAW,IAAI,CAC3C,EAAEyC,UAEHC,EAAA,QAAA,CAAA,GACMhC,GACJC,IAAKuB,GACLG,MAAOE,EAAOI,MACd3C,SAAUA,IAAa,GACvBC,QAASwB,GACTtB,QAAS0B,GACTzB,UAAW0B,GACXxB,YAAAA,GACAsC,WAAYpC,GACZqC,SAAU,EACVC,KAAK,OACLrC,MAAAA,CAAAA,CACD,EACDiC,EAAA,MAAA,CAAKL,MAAOE,EAAOQ,WAAWN,SAC5BC,EAACM,GAAc,EAAA,CAAA,CACZ,EACJvC,IAAUb,GAAgBI,IAAa,GAAO,KAC7C0C,EAAA,SAAA,CACEL,MAAOE,EAAOU,YACdC,QAASpC,EACT+B,SAAU,EAAEJ,SAEZC,EAACS,GAAa,EAAA,CAAA,CACR,CACT,CAAA,CACE,CAET,CAAC;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;"}