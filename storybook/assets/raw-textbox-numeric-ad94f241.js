import{_,h,T}from"./hooks.module-6e460002.js";import{g as getCurrentFromRef}from"./get-current-from-ref-47f174f6.js";import{c as computeNextValue}from"./compute-next-value-3d847061.js";import{i as isKeyCodeCharacterGenerating}from"./is-keycode-character-generating-0746a523.js";import{o}from"./jsxRuntime.module-893eb125.js";import{M as MIXED_STRING,a as MIXED_NUMBER}from"./mixed-values-e51728b2.js";const floatOperandRegex=/^-?\d*(?:\.\d*)?$/,integerOperandRegex=/^-?\d*$/,operatorRegex=/[+\-*/]/,operatorSuffixRegex=/[+\-*/]$/,numbersRegex=/\d/,invalidCharactersRegex=/[^\d.+\-*/]/;function evaluateNumericExpression(value){return value===""||numbersRegex.test(value)===!1||invalidCharactersRegex.test(value)===!0?null:operatorRegex.test(value)===!0?operatorSuffixRegex.test(value)===!0?eval(value.substring(0,value.length-1)):eval(value):parseFloat(value)}function isValidNumericInput(e,r={integersOnly:!1}){const u=(e[0]==="-"?e.substring(1):e).split(operatorRegex);let i=-1;for(;++i<u.length;){const f=u[i];if(f===""&&i!==u.length-1||(r.integersOnly===!0?integerOperandRegex:floatOperandRegex).test(f)===!1)return!1}return!0}const EMPTY_STRING$1="",fractionalPartRegex=/\.([^.]+)/,nonDigitRegex=/[^\d.]/;function formatEvaluatedValue(e,r,u){if(e===null)return EMPTY_STRING$1;const i=countSignificantFigures(nonDigitRegex.test(r)===!0?`${e}`:r);return appendSuffix(formatSignificantFigures(e,i),u)}function countSignificantFigures(e){const r=fractionalPartRegex.exec(e);return r===null?0:r[1].length}function formatSignificantFigures(e,r){if(r===0)return`${e}`;const u=fractionalPartRegex.exec(`${e}`);if(u===null)return`${e}.${"0".repeat(r)}`;const i=u[1],f=r-i.length;return`${e}${"0".repeat(f)}`}function appendSuffix(e,r){return typeof r>"u"?e:e===EMPTY_STRING$1?EMPTY_STRING$1:`${e}${r}`}const FRACTION_DIGITS=3,EMPTY_STRING="";function RawTextboxNumeric({disabled:e=!1,incrementBig:r=10,incrementSmall:u=1,integer:i=!1,maximum:f,minimum:c,name:I,onInput:V=function(){},onNumericValueInput:y=function(){},onValueInput:D=function(){},placeholder:Y,propagateEscapeKeyDown:G=!0,revertOnEscapeKeyDown:P=!1,suffix:l,validateOnBlur:S,value:n,...$}){if(typeof c<"u"&&typeof f<"u"&&c>=f)throw new Error("`minimum` must be less than `maximum`");const w=_(null),M=_(!1),[g,p]=h(EMPTY_STRING),d=T(function(t){const a=getCurrentFromRef(w);a.value=t;const s=document.createEvent("Event");s.initEvent("input",!0,!0),a.dispatchEvent(s)},[]),b=T(function(){if(M.current===!0){M.current=!1;return}if(typeof S<"u"){const t=evaluateValue(n,l),a=S(t);if(typeof a=="number"){d(formatEvaluatedValue(a,n,l)),p(EMPTY_STRING);return}if(a===null){d(EMPTY_STRING),p(EMPTY_STRING);return}if(a===!1){n!==g&&d(g),p(EMPTY_STRING);return}}if(typeof l<"u"&&n===l){d(EMPTY_STRING),p(EMPTY_STRING);return}if(n!==EMPTY_STRING&&n!==MIXED_STRING){const t=evaluateValue(n,l),a=formatEvaluatedValue(t,n,l);n!==a&&d(a)}p(EMPTY_STRING)},[g,d,l,S,n]),F=T(function(t){p(n),t.currentTarget.select()},[n]),N=T(function(t){V(t);const a=t.currentTarget.value;D(a,I);const s=evaluateValue(a,l);y(s,I)},[I,V,y,D,l]),C=T(function(t){const a=t.key;if(a==="Escape"){G===!1&&t.stopPropagation(),P===!0&&(M.current=!0,d(g),p(EMPTY_STRING)),t.currentTarget.blur();return}if(a==="Enter"){t.currentTarget.blur();return}const s=t.currentTarget;if(a==="ArrowDown"||a==="ArrowUp"){const R=t.shiftKey===!0?r:u;if(n===EMPTY_STRING||n===MIXED_STRING){t.preventDefault();const A=function(){return typeof c<"u"&&c>0?c:typeof f<"u"&&f<0?f:0}(),K=restrictValue(evaluateValueWithDelta(A,a==="ArrowDown"?-1*R:R),c,f),U=formatEvaluatedValue(K,n,l);s.value=U,s.select(),N(t);return}const E=evaluateValue(n,l);if(E===null)throw new Error("Invariant violation");t.preventDefault();const k=restrictValue(evaluateValueWithDelta(E,a==="ArrowDown"?-1*R:R),c,f),x=formatEvaluatedValue(k,n,l);if(x===n)return;s.value=x,s.select(),N(t);return}if(!(t.ctrlKey===!0||t.metaKey===!0)&&isKeyCodeCharacterGenerating(t.keyCode)===!0){const R=trimSuffix(n===MIXED_STRING?t.key:computeNextValue(s,t.key),l);if(isValidNumericInput(R,{integersOnly:i})===!1){t.preventDefault();return}if(typeof c>"u"&&typeof f>"u")return;const E=evaluateNumericExpression(R);if(E===null)return;(typeof c<"u"&&E<c||typeof f<"u"&&E>f)&&t.preventDefault()}},[N,r,u,i,f,c,g,G,P,d,l,n]),O=T(function(t){n===MIXED_STRING&&t.preventDefault()},[n]),X=T(function(t){if(t.clipboardData===null)throw new Error("`event.clipboardData` is `null`");const a=trimSuffix(computeNextValue(t.currentTarget,t.clipboardData.getData("Text")),l);isValidNumericInput(a,{integersOnly:i})===!1&&t.preventDefault()},[i,l]);return o("input",{...$,ref:w,disabled:e===!0,name:I,onBlur:b,onFocus:F,onInput:N,onKeyDown:C,onMouseUp:O,onPaste:X,placeholder:Y,spellcheck:!1,tabIndex:e===!0?-1:0,type:"text",value:n===MIXED_STRING?"Mixed":n})}function restrictValue(e,r,u){return typeof r<"u"?typeof u<"u"?Math.min(Math.max(e,r),u):Math.max(e,r):typeof u<"u"?Math.min(e,u):e}function evaluateValue(e,r){return e===MIXED_STRING?MIXED_NUMBER:e===EMPTY_STRING?null:evaluateNumericExpression(trimSuffix(e,r))}function evaluateValueWithDelta(e,r){return parseFloat((e+r).toFixed(FRACTION_DIGITS))}function trimSuffix(e,r){return typeof r>"u"?e:e.replace(new RegExp(`${r}$`),EMPTY_STRING)}export{RawTextboxNumeric as R};
//# sourceMappingURL=raw-textbox-numeric-ad94f241.js.map
