{"version":3,"file":"file-upload-dropzone-66f5398d.js","sources":["../../src/components/file-upload/file-upload-dropzone/file-upload-dropzone.tsx"],"sourcesContent":["import { ComponentChildren, h } from 'preact'\nimport { useCallback, useState } from 'preact/hooks'\n\nimport { Event, EventHandler } from '../../../types/event-handler.js'\nimport { FocusableComponentProps } from '../../../types/focusable-component-props.js'\nimport { createClassName } from '../../../utilities/create-class-name.js'\nimport { createComponent } from '../../../utilities/create-component.js'\nimport { noop } from '../../../utilities/no-op.js'\nimport { fileComparator } from '../private/file-comparator.js'\nimport styles from './file-upload-dropzone.module.css'\n\nexport interface FileUploadDropzoneProps\n  extends FocusableComponentProps<HTMLInputElement> {\n  acceptedFileTypes?: Array<string>\n  children: ComponentChildren\n  multiple?: boolean\n  onBlur?: EventHandler.onBlur<HTMLInputElement>\n  onChange?: EventHandler.onChange<HTMLInputElement>\n  onDragEnd?: EventHandler.onDragEnd<HTMLInputElement>\n  onDragEnter?: EventHandler.onDragEnter<HTMLInputElement>\n  onDragOver?: EventHandler.onDragOver<HTMLInputElement>\n  onDrop?: EventHandler.onDrop<HTMLInputElement>\n  onSelectedFiles?: EventHandler.onSelectedFiles\n}\n\nexport const FileUploadDropzone = createComponent<\n  HTMLInputElement,\n  FileUploadDropzoneProps\n>(function (\n  {\n    acceptedFileTypes = [],\n    children,\n    multiple = false,\n    onBlur = noop,\n    onChange = noop,\n    onDragEnd = noop,\n    onDragEnter = noop,\n    onDragOver = noop,\n    onDrop = noop,\n    onKeyDown = noop,\n    onSelectedFiles = noop,\n    propagateEscapeKeyDown = true,\n    ...rest\n  },\n  ref\n) {\n  const [isDropActive, setIsDropActive] = useState<boolean>(false)\n\n  const handleBlur = useCallback(\n    function (event: Event.onBlur<HTMLInputElement>) {\n      onBlur(event)\n      setIsDropActive(false)\n    },\n    [onBlur]\n  )\n\n  const handleChange = useCallback(\n    function (event: Event.onChange<HTMLInputElement>) {\n      onChange(event)\n      const fileList = event.currentTarget.files\n      if (fileList === null) {\n        throw new Error('`event.currentTarget.files` is `null`')\n      }\n      const files = parseFileList({ acceptedFileTypes, fileList })\n      if (files.length > 0) {\n        onSelectedFiles(files)\n      }\n    },\n    [acceptedFileTypes, onChange, onSelectedFiles]\n  )\n\n  const handleDragEnter = useCallback(\n    function (event: Event.onDragEnter<HTMLInputElement>) {\n      onDragEnter(event)\n      event.preventDefault()\n    },\n    [onDragEnter]\n  )\n\n  const handleDragOver = useCallback(\n    function (event: Event.onDragOver<HTMLInputElement>) {\n      onDragOver(event)\n      event.preventDefault()\n      setIsDropActive(true)\n    },\n    [onDragOver]\n  )\n\n  const handleDragEnd = useCallback(\n    function (event: Event.onDragEnd<HTMLInputElement>) {\n      onDragEnd(event)\n      event.preventDefault()\n      setIsDropActive(false)\n    },\n    [onDragEnd]\n  )\n\n  const handleDrop = useCallback(\n    function (event: Event.onDrop<HTMLInputElement>) {\n      onDrop(event)\n      if (event.dataTransfer === null) {\n        throw new Error('`event.dataTransfer` is `null`')\n      }\n      event.preventDefault()\n      const fileList = event.dataTransfer.files\n      const files = parseFileList({ acceptedFileTypes, fileList })\n      if (files.length > 0) {\n        onSelectedFiles(files)\n      }\n      setIsDropActive(false)\n    },\n    [acceptedFileTypes, onDrop, onSelectedFiles]\n  )\n\n  const handleKeyDown = useCallback(\n    function (event: Event.onKeyDown<HTMLInputElement>) {\n      onKeyDown(event)\n      if (event.key === 'Escape') {\n        if (propagateEscapeKeyDown === false) {\n          event.stopPropagation()\n        }\n        event.currentTarget.blur()\n      }\n    },\n    [onKeyDown, propagateEscapeKeyDown]\n  )\n\n  return (\n    <div\n      class={createClassName([\n        styles.fileUploadDropzone,\n        isDropActive === true ? styles.isDropActive : null\n      ])}\n    >\n      <input\n        {...rest}\n        ref={ref}\n        accept={\n          acceptedFileTypes.length === 0\n            ? undefined\n            : acceptedFileTypes.join(',')\n        }\n        class={styles.input}\n        multiple={multiple}\n        onBlur={handleBlur}\n        onChange={handleChange}\n        onDragEnd={handleDragEnd}\n        onDragEnter={handleDragEnter}\n        onDragOver={handleDragOver}\n        onDrop={handleDrop}\n        onKeyDown={handleKeyDown}\n        tabIndex={0}\n        title=\"\"\n        type=\"file\"\n      />\n      <div class={styles.fill} />\n      <div class={styles.border} />\n      <div class={styles.children}>{children}</div>\n    </div>\n  )\n})\n\nfunction parseFileList(options: {\n  fileList: FileList\n  acceptedFileTypes: Array<string>\n}): Array<File> {\n  const { fileList, acceptedFileTypes } = options\n  const result = Array.prototype.slice.call(fileList).sort(fileComparator)\n  if (acceptedFileTypes.length === 0) {\n    return result\n  }\n  return result.filter(function (file): boolean {\n    return acceptedFileTypes.indexOf(file.type) !== -1\n  })\n}\n"],"names":["FileUploadDropzone","createComponent","acceptedFileTypes","children","multiple","onBlur","noop","onChange","onDragEnd","onDragEnter","onDragOver","onDrop","onKeyDown","onSelectedFiles","propagateEscapeKeyDown","rest","ref","isDropActive","setIsDropActive","useState","handleBlur","useCallback","event","handleChange","fileList","currentTarget","files","Error","parseFileList","length","handleDragEnter","preventDefault","handleDragOver","handleDragEnd","handleDrop","dataTransfer","handleKeyDown","key","stopPropagation","blur","_jsxs","class","createClassName","styles","fileUploadDropzone","_jsx","accept","undefined","join","input","tabIndex","title","type","fill","border","options","result","Array","prototype","slice","call","sort","fileComparator","filter","file","indexOf"],"mappings":"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"}