{"version":3,"file":"modal-ce83857a.js","sources":["../../src/components/modal/modal.tsx"],"sourcesContent":["import { ComponentChild, Fragment, h, JSX, RefObject, render } from 'preact'\nimport { useEffect, useRef } from 'preact/hooks'\n\nimport { IconCross32 } from '../../icons/icon-32/icon-cross-32.js'\nimport { createClassName } from '../../utilities/create-class-name.js'\nimport { createFocusTrapKeyDownHandler } from '../../utilities/private/create-focus-trap-key-down-handler.js'\nimport { getFocusableElements } from '../../utilities/private/get-focusable-elements.js'\nimport { IconButton } from '../icon-button/icon-button.js'\nimport { Text } from '../text/text.js'\nimport styles from './modal.module.css'\n\nexport type ModalProps = {\n  children: ComponentChild\n  closeButtonIcon?: ComponentChild\n  closeButtonPosition?: ModalCloseButtonPosition\n  open: boolean\n  noTransition?: boolean\n  onCloseButtonClick?: JSX.MouseEventHandler<HTMLButtonElement>\n  onEscapeKeyDown?: (event: KeyboardEvent) => void\n  onOverlayClick?: JSX.MouseEventHandler<HTMLDivElement>\n  position?: ModalPosition\n  title?: string\n}\nexport type ModalCloseButtonPosition = 'left' | 'right'\nexport type ModalPosition = 'bottom' | 'center' | 'left' | 'right'\n\nconst rootElements: Array<HTMLDivElement> = [] // Stack of currently-open modals\n\nexport function Modal({\n  children,\n  closeButtonIcon = <IconCross32 />,\n  closeButtonPosition = 'right',\n  open,\n  noTransition = false,\n  onCloseButtonClick,\n  onEscapeKeyDown,\n  onOverlayClick,\n  position = 'center',\n  title,\n  ...rest\n}: ModalProps): null {\n  const rootElementRef: RefObject<HTMLDivElement> = useRef(null)\n  const previousFocusedElementRef: RefObject<HTMLElement> = useRef(null)\n\n  useEffect(function (): () => void {\n    const rootElement = document.createElement('div')\n    document.body.appendChild(rootElement)\n    rootElementRef.current = rootElement\n    return function (): void {\n      document.body.removeChild(rootElement)\n    }\n  }, [])\n\n  useEffect(\n    function (): () => void {\n      if (rootElementRef.current === null) {\n        throw new Error('`rootElementRef.current` is `null`')\n      }\n      const focusTrapKeyDownHandler = createFocusTrapKeyDownHandler(\n        rootElementRef.current\n      )\n      function handleTabKeyDown(event: KeyboardEvent) {\n        if (open === true) {\n          focusTrapKeyDownHandler(event)\n        }\n      }\n      window.addEventListener('keydown', handleTabKeyDown)\n      return function (): void {\n        window.removeEventListener('keydown', handleTabKeyDown)\n      }\n    },\n    [open]\n  )\n\n  useEffect(\n    function (): () => void {\n      function handleEscapeKeyDown(event: KeyboardEvent) {\n        if (\n          open === false ||\n          event.key !== 'Escape' ||\n          typeof onEscapeKeyDown === 'undefined' ||\n          rootElements[rootElements.length - 1] !== rootElementRef.current\n        ) {\n          return\n        }\n        onEscapeKeyDown(event)\n      }\n      window.addEventListener('keydown', handleEscapeKeyDown)\n      return function (): void {\n        window.removeEventListener('keydown', handleEscapeKeyDown)\n      }\n    },\n    [open, onEscapeKeyDown]\n  )\n\n  useEffect(\n    function (): () => void {\n      if (rootElementRef.current === null) {\n        throw new Error('`rootElementRef.current` is `null`')\n      }\n      if (open === true) {\n        rootElements.push(rootElementRef.current)\n        rootElementRef.current.style.cssText =\n          'position:absolute;top:0;left:0;bottom:0;right:0;z-index:1'\n        previousFocusedElementRef.current =\n          document.activeElement as HTMLElement\n        const focusableElements = getFocusableElements(rootElementRef.current)\n        if (focusableElements.length > 0) {\n          focusableElements[0].focus()\n        } else {\n          previousFocusedElementRef.current.blur()\n        }\n      } else {\n        rootElements.pop()\n        rootElementRef.current.style.cssText = 'position:static'\n      }\n      return function (): void {\n        if (previousFocusedElementRef.current !== null) {\n          previousFocusedElementRef.current.focus()\n        }\n      }\n    },\n    [open]\n  )\n\n  useEffect(\n    function (): void {\n      if (rootElementRef.current === null) {\n        throw new Error('`rootElementRef.current` is `null`')\n      }\n      render(\n        <Fragment>\n          <div\n            {...rest}\n            class={createClassName([\n              styles.modal,\n              open === true ? styles.open : null,\n              noTransition === true ? styles.noTransition : null,\n              styles[position]\n            ])}\n          >\n            {children}\n            {typeof onCloseButtonClick === 'undefined' &&\n            typeof title === 'undefined' ? null : (\n              <div class={styles.topBar}>\n                <div class={styles.title}>\n                  {typeof title === 'undefined' ? null : (\n                    <Text>\n                      <strong>{title}</strong>\n                    </Text>\n                  )}\n                </div>\n                {typeof onCloseButtonClick === 'undefined' ? null : (\n                  <div\n                    class={\n                      closeButtonPosition === 'left'\n                        ? styles.closeButtonLeft\n                        : undefined\n                    }\n                  >\n                    <IconButton onClick={onCloseButtonClick}>\n                      {closeButtonIcon}\n                    </IconButton>\n                  </div>\n                )}\n              </div>\n            )}\n          </div>\n          <div\n            class={styles.overlay}\n            onClick={\n              typeof onOverlayClick === 'undefined' ? undefined : onOverlayClick\n            }\n          />\n        </Fragment>,\n        rootElementRef.current\n      )\n    },\n    [\n      children,\n      closeButtonIcon,\n      closeButtonPosition,\n      noTransition,\n      onCloseButtonClick,\n      onOverlayClick,\n      open,\n      position,\n      rest,\n      title\n    ]\n  )\n\n  return null\n}\n"],"names":["rootElements","Modal","children","closeButtonIcon","_jsx","IconCross32","closeButtonPosition","open","noTransition","onCloseButtonClick","onEscapeKeyDown","onOverlayClick","position","title","rest","rootElementRef","useRef","previousFocusedElementRef","useEffect","rootElement","document","createElement","body","appendChild","current","removeChild","Error","focusTrapKeyDownHandler","createFocusTrapKeyDownHandler","handleTabKeyDown","event","addEventListener","removeEventListener","handleEscapeKeyDown","key","length","push","style","cssText","activeElement","focusableElements","getFocusableElements","focus","blur","pop","render","_jsxs","Fragment","class","createClassName","styles","modal","topBar","Text","closeButtonLeft","undefined","IconButton","onClick","overlay"],"mappings":"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"}