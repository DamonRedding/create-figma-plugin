{"version":3,"file":"modal-ca5c9550.js","sources":["../../src/components/modal/modal.tsx"],"sourcesContent":["import { ComponentChild, h, RefObject, render } from 'preact'\nimport { useEffect, useRef } from 'preact/hooks'\n\nimport { IconCross32 } from '../../icons/icon-32/icon-cross-32.js'\nimport { EventHandler } from '../../types/event-handler.js'\nimport { createClassName } from '../../utilities/create-class-name.js'\nimport { createComponent } from '../../utilities/create-component.js'\nimport { getCurrentFromRef } from '../../utilities/get-current-from-ref.js'\nimport { createFocusTrapKeyDownHandler } from '../../utilities/private/create-focus-trap-key-down-handler.js'\nimport { getFocusableElements } from '../../utilities/private/get-focusable-elements.js'\nimport { IconButton } from '../icon-button/icon-button.js'\nimport { Text } from '../text/text.js'\nimport styles from './modal.module.css'\n\nexport type ModalProps = {\n  children: ComponentChild\n  closeButtonIcon?: ComponentChild\n  closeButtonPosition?: ModalCloseButtonPosition\n  open: boolean\n  transition?: boolean\n  onCloseButtonClick?: EventHandler.onClick<HTMLButtonElement>\n  onEscapeKeyDown?: (event: KeyboardEvent) => void\n  onOverlayClick?: EventHandler.onClick<HTMLDivElement>\n  position?: ModalPosition\n  title?: string\n}\n\nexport type ModalCloseButtonPosition = 'left' | 'right'\nexport type ModalPosition = 'bottom' | 'center' | 'left' | 'right'\n\nexport const Modal = createComponent<HTMLDivElement, ModalProps>(function (\n  {\n    children,\n    closeButtonIcon = <IconCross32 />,\n    closeButtonPosition = 'right',\n    open,\n    transition = true,\n    onCloseButtonClick,\n    onEscapeKeyDown,\n    onOverlayClick,\n    position = 'center',\n    title,\n    ...rest\n  },\n  ref\n): null {\n  const portalElementRef: RefObject<HTMLDivElement> = useRef(null)\n  const modalElementsRef: RefObject<Array<HTMLDivElement>> = useRef([]) // Stack of currently-open modals\n  const previousFocusedElementRef: RefObject<HTMLElement> = useRef(null)\n\n  useEffect(function () {\n    const portalElement = document.createElement('div')\n    document.body.appendChild(portalElement)\n    portalElementRef.current = portalElement\n    return function () {\n      document.body.removeChild(portalElement)\n    }\n  }, [])\n\n  useEffect(\n    function () {\n      const portalElement = getCurrentFromRef<HTMLDivElement>(portalElementRef)\n      const focusTrapKeyDownHandler =\n        createFocusTrapKeyDownHandler(portalElement)\n      function handleTabKeyDown(event: KeyboardEvent) {\n        if (open === true) {\n          focusTrapKeyDownHandler(event)\n        }\n      }\n      window.addEventListener('keydown', handleTabKeyDown)\n      return function () {\n        window.removeEventListener('keydown', handleTabKeyDown)\n      }\n    },\n    [open]\n  )\n\n  useEffect(\n    function () {\n      function handleEscapeKeyDown(event: KeyboardEvent) {\n        const modalElements =\n          getCurrentFromRef<Array<HTMLDivElement>>(modalElementsRef)\n        const portalElement =\n          getCurrentFromRef<HTMLDivElement>(portalElementRef)\n        if (\n          open === false ||\n          event.key !== 'Escape' ||\n          typeof onEscapeKeyDown === 'undefined' ||\n          modalElements[modalElements.length - 1] !== portalElement\n        ) {\n          return\n        }\n        onEscapeKeyDown(event)\n      }\n      window.addEventListener('keydown', handleEscapeKeyDown)\n      return function () {\n        window.removeEventListener('keydown', handleEscapeKeyDown)\n      }\n    },\n    [open, onEscapeKeyDown]\n  )\n\n  useEffect(\n    function () {\n      const modalElements =\n        getCurrentFromRef<Array<HTMLDivElement>>(modalElementsRef)\n      const portalElement = getCurrentFromRef<HTMLDivElement>(portalElementRef)\n      const bodyElement = document.body\n      if (open === true) {\n        if (modalElements.length === 0) {\n          const hasScrollbar = bodyElement.scrollHeight > window.innerHeight\n          bodyElement.style.cssText += `position:fixed;overflow-y:${\n            hasScrollbar === true ? 'scroll' : 'hidden'\n          };width:100%;`\n        }\n        modalElements.push(portalElement)\n        portalElement.style.cssText =\n          'position:absolute;top:0;left:0;bottom:0;right:0;z-index:1'\n        previousFocusedElementRef.current =\n          document.activeElement as HTMLElement\n        const focusableElements = getFocusableElements(portalElement)\n        if (focusableElements.length > 0) {\n          focusableElements[0].focus()\n        } else {\n          previousFocusedElementRef.current.blur()\n        }\n      } else {\n        if (modalElements.length === 1) {\n          bodyElement.style.removeProperty('position')\n          bodyElement.style.removeProperty('overflow-y')\n          bodyElement.style.removeProperty('width')\n        }\n        modalElements.pop()\n        portalElement.style.cssText = 'position:static'\n      }\n      return function () {\n        if (previousFocusedElementRef.current !== null) {\n          previousFocusedElementRef.current.focus()\n        }\n      }\n    },\n    [open]\n  )\n\n  useEffect(\n    function () {\n      const portalElement = getCurrentFromRef<HTMLDivElement>(portalElementRef)\n      render(\n        <div ref={ref}>\n          <div\n            {...rest}\n            class={createClassName([\n              styles.modal,\n              open === true ? styles.open : null,\n              transition === false ? styles.noTransition : null,\n              styles[position]\n            ])}\n          >\n            {children}\n            {typeof onCloseButtonClick === 'undefined' &&\n            typeof title === 'undefined' ? null : (\n              <div class={styles.topBar}>\n                <div class={styles.title}>\n                  {typeof title === 'undefined' ? null : (\n                    <Text>\n                      <strong>{title}</strong>\n                    </Text>\n                  )}\n                </div>\n                {typeof onCloseButtonClick === 'undefined' ? null : (\n                  <div\n                    class={\n                      closeButtonPosition === 'left'\n                        ? styles.closeButtonLeft\n                        : undefined\n                    }\n                  >\n                    <IconButton onClick={onCloseButtonClick}>\n                      {closeButtonIcon}\n                    </IconButton>\n                  </div>\n                )}\n              </div>\n            )}\n          </div>\n          <div\n            class={styles.overlay}\n            onClick={\n              typeof onOverlayClick === 'undefined' ? undefined : onOverlayClick\n            }\n          />\n        </div>,\n        portalElement\n      )\n    },\n    [\n      children,\n      closeButtonIcon,\n      closeButtonPosition,\n      onCloseButtonClick,\n      onOverlayClick,\n      open,\n      position,\n      ref,\n      rest,\n      title,\n      transition\n    ]\n  )\n\n  return null\n})\n"],"names":["Modal","createComponent","children","closeButtonIcon","_jsx","IconCross32","closeButtonPosition","open","transition","onCloseButtonClick","onEscapeKeyDown","onOverlayClick","position","title","rest","ref","portalElementRef","useRef","modalElementsRef","previousFocusedElementRef","useEffect","portalElement","document","createElement","body","appendChild","current","removeChild","getCurrentFromRef","focusTrapKeyDownHandler","createFocusTrapKeyDownHandler","handleTabKeyDown","event","addEventListener","removeEventListener","handleEscapeKeyDown","modalElements","key","length","bodyElement","hasScrollbar","scrollHeight","window","innerHeight","style","cssText","push","activeElement","focusableElements","getFocusableElements","focus","blur","removeProperty","pop","render","_jsxs","class","createClassName","styles","modal","noTransition","topBar","Text","closeButtonLeft","undefined","IconButton","onClick","overlay"],"mappings":"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"}